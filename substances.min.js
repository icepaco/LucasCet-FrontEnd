var NOM_DEFAUT="Nom de la Substance";var dataBank={bucket:null,fbUserId:"",listeSubstances:[],xDoc:null};Function.prototype.inheritsFrom=function(parentClassOrObject){if(parentClassOrObject.constructor==Function){this.prototype=new parentClassOrObject;this.prototype.constructor=this;this.prototype.parent=parentClassOrObject.prototype}else{this.prototype=parentClassOrObject;this.prototype.constructor=this;this.prototype.parent=parentClassOrObject}return this};
function Substance(_Node){if(!_Node){_Node={};_Node.visuals=[];_Node.title=NOM_DEFAUT}else this.updateVisual();Object.defineProperty(this,"Id",{value:_Node.subId});Object.defineProperty(this,"Name",{get:function(){if(!_Node.title||_Node.title==NOM_DEFAUT)_Node.title=this.getName();return _Node.title},set:function(value){_Node.title=value}});Object.defineProperty(this,"Graphic",{value:_Node.visuals});Object.defineProperty(this,"Visual",{get:function(){return this.getVisual()}});Object.defineProperty(this,
"Url",{value:_Node.visuals[0],writable:true});Object.defineProperty(this,"OnClick",{set:function(newVal){this.setHandler(newVal)}})}Substance.inheritsFrom(dataBank);Substance.prototype.getVisual=function(){return null};Substance.prototype.getName=function(){return null};Substance.prototype.setHandler=function(eventHandler){};Substance.MetaDataName="";
function SubstancePotentielle(_Node){Substance.call(this,_Node);var link=document.querySelector('link[rel="import"]');var article=link.import.querySelector("section.potCon");this.type="Substance";this.elemVisual=article.cloneNode(true);this.RecordSubstance=function(linkSubstance,linkFunction){}}SubstancePotentielle.inheritsFrom(Substance);SubstancePotentielle.prototype.getName=function(){if(this.elemVisual){var txt=$(this.elemVisual).find(".sName")[0];if(txt.value)return txt.value;else return NOM_DEFAUT}else return NOM_DEFAUT};
SubstancePotentielle.prototype.resetName=function(){if(this.elemVisual){var txt=$(this.elemVisual).find(".sName")[0];txt.value=NOM_DEFAUT}this.Name=NOM_DEFAUT};SubstancePotentielle.prototype.getVisual=function(){if(this.elemVisual){var img=$(this.elemVisual).find(".imgSub")[0];img.src=this.Url;var txt=$(this.elemVisual).find(".sName")[0];if(this.Name!=NOM_DEFAUT){txt.value=this.Name;$(txt).prop("readonly",true)}}return this.elemVisual};
SubstancePotentielle.prototype.updateVisual=function(){if(this.elemVisual){var img=$(this.elemVisual).find(".imgSub")[0];img.src=this.Url}};SubstancePotentielle.prototype.setHandler=function(eventHandler){if(this.elemVisual){if(this.elemVisual.onclick)this.elemVisual.removeEventListener("click",this.elemVisual.onclick);this.elemVisual.id=this.parent.listeSubstances.indexOf(this);this.elemVisual.onclick=eventHandler}};
SubstancePotentielle.prototype.moveSubstance=function(screen1,screen2,event1,event2){var newScreen=screen1;var that=this;screen2.childNodes.forEach(function(visualz){if(visualz==that.Visual){visualz.removeEventListener("click",event2);visualz.addEventListener("click",event1);visualz.remove();newScreen.appendChild(visualz)}})};SubstancePotentielle.prototype.Integrate=function(substances){};
function SubstanceAction(_Node){Substance.call(this,_Node);if(!_Node){_Node={};_Node.linkedSubstances=[];_Node.functionId="Default"}var link=document.querySelector('link[rel="import"]');var article=link.import.querySelector("section.motSub");this.type="SubstanceAction";this.elemVisual=article.cloneNode(true);this.RecordSubstance=function(linkSubstance,linkFunction){var that=this;linkFunction(this.Action,function(){linkSubstance(that.Principale,function(){})})};Object.defineProperty(this,"Principale",
{get:function(){return _Node.firstSubstance},set:function(obj){if($.isArray(obj))obj.forEach(function(substance){if(substance.Id==_Node.firstSubstance)_Node.firstSubstance=substance});else if(typeof obj=="string"||obj instanceof String||obj instanceof Substance)_Node.firstSubstance=obj;else throw new Error("Non compatible element for SubstanceAction.Principale");}});Object.defineProperty(this,"Action",{value:_Node.functionId,writable:true})}SubstanceAction.inheritsFrom(Substance);
SubstanceAction.prototype.getName=function(){if(this.elemVisual){var txt=$(this.elemVisual).find(".dynaId")[0];return txt.value}else return""};SubstanceAction.prototype.getVisual=function(){if(this.elemVisual){var vid=$(this.elemVisual).find(".vidMotrice")[0];vid.src=this.Url;$(vid).attr("controls",true);var txt=$(this.elemVisual).find(".dynaId")[0];if(this.Name!=NOM_DEFAUT){txt.value=this.Name;$(txt).prop("readonly",true)}}return this.elemVisual};
SubstanceAction.prototype.deployVisual=function(btnAdd){var princHolder=$(this.elemVisual).find(".listSubstance")[0];if(!this.Principal){var that=this;this.bouton=btnAdd;$(princHolder).empty();for(var i=0;i<this.parent.listeSubstances.length;i++){this.parent.listeSubstances[i].OnClick=function(event){var selectId=event.currentTarget.id;var selectedSubstance=that.parent.listeSubstances[selectId];selectedSubstance.Visual.removeEventListener("click",selectedSubstance.onclick);$(princHolder).empty();
princHolder.appendChild(selectedSubstance.Visual.cloneNode(true));that.Principale=selectedSubstance.Id;that.parent.listeSubstances.length=0;that.bouton.style.display="block"};princHolder.appendChild(this.parent.listeSubstances[i].Visual)}}princHolder.style.display="block";return this.elemVisual};SubstanceAction.prototype.updateVisual=function(){if(this.elemVisual){var vid=$(this.elemVisual).find(".vidMotrice")[0];vid.src=this.Url}};
SubstanceAction.prototype.setHandler=function(eventHandler){if(this.elemVisual){if(this.elemVisual.onclick)this.elemVisual.removeEventListener("click",this.elemVisual.onclick);this.elemVisual.id=this.parent.listeSubstances.indexOf(this);this.elemVisual.onclick=eventHandler}};
SubstanceAction.prototype.moveSubstance=function(screen1,screen2,event1,event2){var newScreen=screen1;var that=this;screen2.childNodes.forEach(function(visualz){if(visualz==that.Visual){visualz.removeEventListener("click",event2);visualz.addEventListener("click",event1);visualz.remove();newScreen.appendChild(visualz)}});this.Principale.moveSubstance(screen1,screen2,event1,event2)};SubstanceAction.prototype.Integrate=function(substances){this.Principale=substances};
function SubstanceRelation(_Node){Substance.call(this,_Node);var link=document.querySelector('link[rel="import"]');var article=link.import.querySelector("section.relationSub");if(!_Node){_Node={};_Node.linkedSubstances=[];_Node.functionId="Default"}this.type="SubstanceRelation";this.elemVisual=article.cloneNode(true);this.RecordSubstance=function(linkSubstance,linkFunction){var that=this;linkFunction(this.Reliure,function(){linkSubstance(that.Substance1.Id,function(){linkSubstance(that.Substance2.Id,
function(){})})})};Object.defineProperty(this,"Substance1",{get:function(){return _Node.firstSubstance},set:function(obj){if($.isArray(obj))obj.forEach(function(substance){if(substance.Id==_Node.firstSubstance)_Node.firstSubstance=substance});else if(typeof obj=="string"||obj instanceof String||obj instanceof Substance)_Node.firstSubstance=obj;else throw new Error("Non compatible element for SubstanceRelation.Substance1");}});Object.defineProperty(this,"Reliure",{value:_Node.functionId,writable:true});
Object.defineProperty(this,"Substance2",{get:function(){return _Node.secondSubstance},set:function(obj){if($.isArray(obj))obj.forEach(function(substance){if(substance.Id==_Node.secondSubstance)_Node.secondSubstance=substance});else if(typeof obj=="string"||obj instanceof String||obj instanceof Substance)_Node.secondSubstance=obj;else throw new Error("Non compatible element for SubstanceRelation.Substance2");}})}SubstanceRelation.inheritsFrom(Substance);
SubstanceRelation.prototype.getName=function(){if(this.elemVisual){var txt=$(this.elemVisual).find(".relationName")[0];return txt.value}else return""};
SubstanceRelation.prototype.moveSubstance=function(screen1,screen2,event1,event2){var newScreen=screen1;var that=this;screen2.childNodes.forEach(function(visualz){if(visualz==that.Visual){visualz.removeEventListener("click",event2);visualz.addEventListener("click",event1);visualz.remove();newScreen.appendChild(visualz)}});this.Substance1.moveSubstance(screen1,screen2,event1,event2);this.Substance2.moveSubstance(screen1,screen2,event1,event2)};
SubstanceRelation.prototype.getVisual=function(){if(this.elemVisual){var img=$(this.elemVisual).find(".imgRel")[0];img.dataSource=this.Url;var imgVideo=$(this.elemVisual).find(".vidRel")[0];img.videoSource=imgVideo;img.onerror=function(eve){imgErr=eve.currentTarget;var vid=imgErr.videoSource;vid.src=imgErr.dataSource;$(vid).attr("controls",true);vid.style.display="";imgErr.style.display="none"};img.src=this.Url;img.style.display="";var txt=$(this.elemVisual).find(".relationName")[0];if(this.Name!=
NOM_DEFAUT){txt.value=this.Name;$(txt).prop("readonly",true)}}return this.elemVisual};
SubstanceRelation.prototype.deployVisual=function(btnAdd){var firstHolder=$(this.elemVisual).find(".liee1")[0];if(!this.Substance1){var that=this;this.bouton=btnAdd;$(firstHolder).empty();for(var i=0;i<this.listeSubstances.length;i++){this.listeSubstances[i].OnClick=function(event){var selectId=event.currentTarget.id;var selectedSubstance=that.parent.listeSubstances[selectId];selectedSubstance.Visual.removeEventListener("click",selectedSubstance.onclick);$(firstHolder).empty();firstHolder.appendChild(selectedSubstance.Visual.cloneNode(true));
that.Substance1=selectedSubstance;that.deployVisual2(that.bouton)};firstHolder.appendChild(this.listeSubstances[i].Visual)}}var relShow=$(this.elemVisual).find(".relHolder")[0];relShow.style.display="block";return this.elemVisual};
SubstanceRelation.prototype.deployVisual2=function(btnAdd){var secondHolder=$(this.elemVisual).find(".liee2")[1];if(!secondHolder)secondHolder=$(this.elemVisual).find(".liee2")[0];if(!this.Substance2){var that=this;this.bouton=btnAdd;$(secondHolder).empty();for(var i=0;i<this.listeSubstances.length;i++)if(this.listeSubstances[i].Id!=this.Substance1.Id){this.listeSubstances[i].OnClick=function(event){var selectId=event.currentTarget.id;var selectedSubstance=that.parent.listeSubstances[selectId];selectedSubstance.Visual.removeEventListener("click",
selectedSubstance.onclick);$(secondHolder).empty();secondHolder.appendChild(selectedSubstance.Visual.cloneNode(true));that.Substance2=selectedSubstance;that.bouton.style.display="block"};secondHolder.appendChild(this.listeSubstances[i].Visual)}}};
SubstanceRelation.prototype.updateVisual=function(){if(this.elemVisual)if(this.isAnim){var vid=$(this.elemVisual).find(".vidRel")[0];vid.src=this.Url;vid.style.display=""}else{var img=$(this.elemVisual).find(".imgRel")[0];img.src=this.Url;img.style.display=""}};
SubstanceRelation.prototype.setHandler=function(eventHandler){if(this.elemVisual){if(this.elemVisual.onclick)this.elemVisual.removeEventListener("click",this.elemVisual.onclick);this.elemVisual.id=this.parent.listeSubstances.indexOf(this);this.elemVisual.onclick=eventHandler}};SubstanceRelation.prototype.Integrate=function(substances){this.Substance1=substances;this.Substance2=substances};
function Sequence(_Node){Substance.call(this,_Node);var link=document.querySelector('link[rel="import"]');var article=link.import.querySelector("#seqTab");this.elemVisual=article.cloneNode(true);if(!_Node){_Node={};_Node.linkedSubstances=[]}this.type="Sequence";this.SelectedPane=$(this.elemVisual).find("#lstSeqSub")[0];this.SelectionPane=$(this.elemVisual).find("#lstSelection")[0];$(this.SelectedPane).empty();$(this.SelectionPane).empty();var iterator=0;Object.defineProperty(this,"Substances",{get:function(){var $jscomp$generator$state=
0;var i;function $jscomp$generator$impl($jscomp$generator$action$arg,$jscomp$generator$next$arg,$jscomp$generator$throw$arg){while(1)switch($jscomp$generator$state){case 0:i=0;case 1:if(!(i<_Node.linkedSubstances.length)){$jscomp$generator$state=3;break}$jscomp$generator$state=4;return{value:_Node.linkedSubstances[i],done:false};case 4:if(!($jscomp$generator$action$arg==1)){$jscomp$generator$state=5;break}$jscomp$generator$state=-1;throw $jscomp$generator$throw$arg;case 5:case 2:i++;$jscomp$generator$state=
1;break;case 3:$jscomp$generator$state=-1;default:return{value:undefined,done:true}}}var iterator={next:function(arg){return $jscomp$generator$impl(0,arg,undefined)},throw:function(arg){return $jscomp$generator$impl(1,undefined,arg)},return:function(arg){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();iterator[Symbol.iterator]=function(){return this};return iterator},set:function(newVal){_Node.linkedSubstances.push(newVal)}});Object.defineProperty(this,"AddNewSelection",{set:function(substance){substance.Visual.parentSubstance=
substance;substance.sequence=this;this.SelectionPane.append(substance.Visual);substance.Visual.addEventListener("click",this.selectSubstance)}});this.RecordSubstance=function(linkSequence){var that=this;this.SelectedPane.childNodes.forEach(function(visualz){var substance=visualz.parentSubstance;that.Substances=substance});this.linkSeq2Sub=linkSequence;this.sub=this.Substances;this.linkNewSub()};this.linkNewSub=function(){var valSub=this.sub.next();if(!valSub.done)this.linkSeq2Sub(valSub.value.Id,
this.linkNewSub)}}Sequence.inheritsFrom(Substance);Sequence.prototype.getName=function(){if(this.elemVisual){var txt=$(this.elemVisual).find(".sequenceId")[0];return txt.value}else return""};
Sequence.prototype.selectSubstance=function(event){var selectVisual=event.currentTarget;var selectSubstance=selectVisual.parentSubstance;var seq=selectSubstance.sequence;selectSubstance.moveSubstance(seq.SelectedPane,seq.SelectionPane,seq.unselectSubstance,seq.selectSubstance);if(seq.SelectedPane.childNodes.length>0)seq.bouton.style.display="block"};
Sequence.prototype.unselectSubstance=function(event){var selectVisual=event.currentTarget;var selectSubstance=selectVisual.parentSubstance;var seq=selectSubstance.sequence;selectSubstance.moveSubstance(seq.SelectionPane,seq.SelectedPane,seq.selectSubstance,seq.unselectSubstance);if(seq.SelectedPane.childNodes.length<1)seq.bouton.style.display=""};
Sequence.prototype.getVisual=function(){if(this.elemVisual){var vid=$(this.elemVisual).find("#vidSeq")[0];vid.src=this.Url;$(vid).attr("controls",true);var txt=$(this.elemVisual).find(".sequenceId")[0];this.elemVisual.owner=this;if(this.Name!=NOM_DEFAUT){txt.value=this.Name;$(txt).prop("readonly",true)}}return this.elemVisual};
Sequence.prototype.deployVisual=function(btnAdd){var vid=$(this.elemVisual).find("#vidSeq")[0];vid.src=this.Url;$(vid).attr("controls",true);this.bouton=btnAdd;this.SelectedPane.style.display="block";this.SelectionPane.style.display="block";return this.elemVisual};Sequence.prototype.updateVisual=function(){if(this.elemVisual){var vid=$(this.elemVisual).find("#vidSeq")[0];vid.src=this.Url}};
Sequence.prototype.setHandler=function(eventHandler){if(this.elemVisual){if(this.elemVisual.onclick)this.elemVisual.removeEventListener("click",this.elemVisual.onclick);this.elemVisual.owner=this;this.elemVisual.onclick=eventHandler}};
function BoutonActivateur(image,textTitre,action,idnum){var link=document.querySelector('link[rel="import"]');var article=link.import.querySelector(".imgInteractif");var bouton=article.cloneNode(true);var boutonID="bouton-sub"+idnum;$(bouton).attr("id",boutonID);var btn=$(bouton).find("input.activateur");btn.click(function(){$(".imgInteractif").fadeOut("slow").promise().done(function(){action(event)})});$(bouton).find(".txtTitre").html(textTitre);Object.defineProperty(this,"Div",{get:function(){return bouton}})}
BoutonActivateur.affiche=function(){$(".imgInteractif").fadeIn("slow")};
